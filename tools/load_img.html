<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Load Image</title>
    
    <script>
"use strict";

var filename1;
filename1="../../phototeque/P1080641.JPG";
var filename2;
filename2="../src/image_out.jpeg";

var tx, ty;
tx = 0;
ty = 0;
var zx, zy;
zx=1;
zy=1;
var isMove;
isMove=false;
var startX, startY;
var mouseX, mouseY;
var rect1, rect2;
var ctx1, ctx2;
var cursorX, cursorY;
var img1, img2;

function updateImg() {
  ctx1.drawImage(img1, tx, ty, rect1.width * zx, rect1.height *zy, 0, 0, rect1.width, rect1.height);
  ctx2.drawImage(img2, tx, ty, rect2.width * zx, rect2.height *zy, 0, 0, rect2.width, rect2.height);

  ctx1.beginPath();
  ctx1.moveTo(cursorX, 0);
  ctx1.lineTo(cursorX, rect1.height);
  ctx1.stroke();
  
  ctx1.beginPath();
  ctx1.moveTo(0, cursorY);
  ctx1.lineTo(rect1.width, cursorY);
  ctx1.stroke();
  
  ctx2.beginPath();
  ctx2.moveTo(cursorX, 0);
  ctx2.lineTo(cursorX, rect2.height);
  ctx2.stroke();
  
  ctx2.beginPath();
  ctx2.moveTo(0, cursorY);
  ctx2.lineTo(rect2.width, cursorY);
  ctx2.stroke();
};

function draw() {
  var canvas1 = document.getElementById('imageView_1');
  // rect est un objet DOMRect avec 6 propriétés
  // left, top, right, bottom, width, height
  rect1 = canvas1.getBoundingClientRect()
  ctx1 = canvas1.getContext('2d');
  ctx1.imageSmoothingEnabled = false;
  ctx1.strokeStyle = '#FFFFFF';
  
  var canvas2 = document.getElementById('imageView_2');
  //rect est un objet DOMRect avec 6 propriétés
  // left, top, right, bottom, width, height
  rect2 = canvas2.getBoundingClientRect()
  ctx2 = canvas2.getContext('2d');
  ctx2.imageSmoothingEnabled = false;
  ctx2.strokeStyle = '#FFFFFF';
  
  img1 = new Image();   // Crée un nouvel élément img
  img1.addEventListener('load', function() {
    // exécute les instructions drawImage ici
    // ctx.fillRect(110, 110, 50, 50);
    // ctx.drawImage(img, 0, 0);
    // drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
    ctx1.drawImage(img1, tx, ty, rect1.width, rect1.height, 0, 0, rect1.width, rect1.height);

    console.log("done");
  }, false);
  img1.src = filename1; // définit le chemin de la source
  
  img2 = new Image();   // Crée un nouvel élément img
  img2.addEventListener('load', function() {
    // exécute les instructions drawImage ici
    // ctx.fillRect(110, 110, 50, 50);
    // ctx.drawImage(img, 0, 0);
    // drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)
    ctx2.drawImage(img2, tx, ty, rect2.width, rect2.height, 0, 0, rect2.width, rect2.height);

    console.log("done");
  }, false);
  img2.src = filename2; // définit le chemin de la source
  

  
  canvas1.addEventListener('mousedown', e => {
    startX = e.clientX;
    startY = e.clientY;
    isMove = true;
  });
  
  canvas2.addEventListener('mousedown', e => {
    startX = e.clientX;
    startY = e.clientY;
    isMove = true;
  });
   
  canvas1.addEventListener('mouseup', e => {
    isMove = false;
    cursorX = e.clientX - rect1.left;
    cursorY = e.clientY - rect1.top;
    updateImg();
    
  });
  canvas2.addEventListener('mouseup', e => {
    isMove = false;
    cursorX = e.clientX - rect2.left;
    cursorY = e.clientY - rect2.top;
    updateImg();
    
  });
  
  canvas1.addEventListener('mousemove', e => {
    mouseX = e.clientX - rect1.left;
    mouseY = e.clientY - rect1.top;
    if (isMove === true) {
      tx += (startX - mouseX) * zx;
      ty += (startY - mouseY) * zy;
      // ctx1.drawImage(img1, tx, ty, rect1.width * zx, rect1.height *zy, 0, 0, rect1.width, rect1.height);
      // ctx2.drawImage(img2, tx, ty, rect2.width * zx, rect2.height *zy, 0, 0, rect2.width, rect2.height);
      updateImg();
      startX = mouseX;
      startY = mouseY;
      
      cursorX = mouseX;
      cursorY = mouseY;
      
    }
  });
  
  canvas2.addEventListener('mousemove', e => {
	    mouseX = e.clientX - rect2.left;
	    mouseY = e.clientY - rect2.top;
	    if (isMove === true) {
	      tx += (startX - mouseX) * zx;
	      ty += (startY - mouseY) * zy;
	      // ctx1.drawImage(img1, tx, ty, rect1.width * zx, rect1.height *zy, 0, 0, rect1.width, rect1.height);
	      // ctx2.drawImage(img2, tx, ty, rect2.width * zx, rect2.height *zy, 0, 0, rect2.width, rect2.height);
	      updateImg();
	      startX = mouseX;
	      startY = mouseY;
	      
	      cursorX = mouseX;
	      cursorY = mouseY;
	      
	    }
	  });
  
  canvas1.addEventListener("keydown", e => {
   // if (event.isComposing || event.keyCode === 229) {
   console.log("keyCode=" + e.keyCode.toString());
   var px, py;
   px = tx + cursorX * zx;
   py = ty + cursorY * zy;
   if (e.keyCode == 87) {
     zx *= 1.1;
     zy *= 1.1;
     }
   else if (e.keyCode == 88) {
     zx /= 1.1;
     zy /= 1.1;
     };
   console.log("mouse " + cursorX.toString() + " " + cursorY.toString());
   tx = px - cursorX * zx;
   ty = py - cursorY * zy;
   // ctx1.drawImage(img1, tx, ty, rect1.width * zx, rect1.height *zy, 0, 0, rect1.width, rect1.height);
   // ctx2.drawImage(img2, tx, ty, rect2.width * zx, rect2.height *zy, 0, 0, rect2.width, rect2.height);
   updateImg();
  });
  
  canvas2.addEventListener("keydown", e => {
	   // if (event.isComposing || event.keyCode === 229) {
	   console.log("keyCode=" + e.keyCode.toString());
	   var px, py;
	   px = tx + cursorX * zx;
	   py = ty + cursorY * zy;
	   if (e.keyCode == 87) {
	     zx *= 1.1;
	     zy *= 1.1;
	     }
	   else if (e.keyCode == 88) {
	     zx /= 1.1;
	     zy /= 1.1;
	     };
	   console.log("mouse " + cursorX.toString() + " " + cursorY.toString());
	   tx = px - cursorX * zx;
	   ty = py - cursorY * zy;
	   // ctx1.drawImage(img1, tx, ty, rect1.width * zx, rect1.height *zy, 0, 0, rect1.width, rect1.height);
	   // ctx2.drawImage(img2, tx, ty, rect2.width * zx, rect2.height *zy, 0, 0, rect2.width, rect2.height);
	   updateImg();
	  });
  
}

    </script>
</head>

<body onload="draw();">
  <canvas id="imageView_1" width="600" height="600" tabindex='1'></canvas>
  <canvas id="imageView_2" width="600" height="600" tabindex='1'></canvas>
</body>
</html>

<!-- end of file -->
